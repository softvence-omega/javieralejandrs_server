<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Firebase Phone Auth Test</title>
  </head>
  <body>
    <h2>Firebase Phone Login</h2>

    <input type="text" id="phoneNumber" placeholder="+8801234567890" />
    <button onclick="sendOTP()">Send OTP</button>

    <div id="recaptcha-container"></div>

    <br /><br />

    <input type="text" id="otp" placeholder="Enter OTP" />
    <button onclick="verifyOTP()">Verify OTP</button>

    <h3 id="result"></h3>

    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: 'AIzaSyDC6MG8FzxokyMIJpsykrzOYMc90K2hqF0',
        authDomain: 'bbehmer-92d94.firebaseapp.com',
        projectId: 'bbehmer-92d94',
        storageBucket: 'bbehmer-92d94.firebasestorage.app',
        messagingSenderId: '513607234004',
        appId: '1:513607234004:web:166723f24d70562f40a641',
      };

      firebase.initializeApp(firebaseConfig);

      const auth = firebase.auth();

      window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(
        'recaptcha-container',
        {
          size: 'invisible',
          callback: function (response) {
            // reCAPTCHA solved - will proceed with submit function
            sendOTP();
          },
        },
      );

      let confirmationResult;

      async function sendOTP() {
        const phoneNumber = document.getElementById('phoneNumber').value;
        const appVerifier = window.recaptchaVerifier;

        try {
          confirmationResult = await auth.signInWithPhoneNumber(
            phoneNumber,
            appVerifier,
          );
          document.getElementById('result').innerText = 'OTP sent!';
        } catch (err) {
          document.getElementById('result').innerText = err.message;
        }
      }

      async function verifyOTP() {
        const otp = document.getElementById('otp').value;

        try {
          const result = await confirmationResult.confirm(otp);
          const user = result.user;

          const token = await user.getIdToken();

          document.getElementById('result').innerText =
            'Verified âœ…\n\nID Token:\n' + token;
          console.log('Firebase ID Token:', token);
        } catch (err) {
          document.getElementById('result').innerText =
            'OTP verification failed: ' + err.message;
        }
      }
    </script>
  </body>
</html>
